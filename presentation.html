<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 7: Fine-tuning to Follow Instructions</title>
    <!-- æ·»åŠ  Prism.js CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-okaidia.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --accent-color: #e74c3c;
        --text-color: #333;
        --background-color: #f5f6fa;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
      }

      .slide {
        width: 100vw;
        height: 100vh;
        padding: 2rem;
        display: none;
        position: absolute;
        top: 0;
        left: 0;
      }

      .slide.active {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .slide-content {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-height: 95vh;
        overflow-y: auto;
      }

      h1 {
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        font-size: 2.5rem;
      }

      h2 {
        color: var(--secondary-color);
        margin: 1rem 0;
        font-size: 1.8rem;
      }

      h3 {
        color: var(--accent-color);
        margin: 0.8rem 0;
        font-size: 1.4rem;
      }

      ul,
      ol {
        margin-left: 2rem;
        margin-bottom: 1rem;
        font-size: 1.2rem;
      }

      li {
        margin-bottom: 0.5rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 0.8rem;
        text-align: left;
      }

      th {
        background-color: var(--secondary-color);
        color: white;
      }

      pre {
        background-color: #282c34;
        padding: 1rem;
        border-radius: 5px;
        overflow-x: auto;
        margin: 1rem 0;
      }

      code {
        font-family: "Consolas", monospace;
        font-size: 0.9rem;
      }

      .navigation {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
      }

      .nav-btn {
        padding: 10px 20px;
        background-color: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .nav-btn:hover {
        background-color: var(--primary-color);
      }

      .emoji {
        font-size: 1.2em;
        margin-right: 0.5rem;
      }
    </style>
  </head>
  <body>
    <!-- Slide 1: Chapter Overview -->
    <div class="slide active">
      <div class="slide-content">
        <h1>
          <span class="emoji">ğŸ“˜</span>Chapter 7: Fine-tuning to Follow
          Instructions
        </h1>
        <h2>ç« ç¯€ç›®æ¨™</h2>
        <ul>
          <li>LLM çš„æŒ‡ä»¤å¾®èª¿æµç¨‹ï¼ˆinstruction fine-tuningï¼‰</li>
          <li>å¦‚ä½•æº–å‚™æŒ‡ä»¤è³‡æ–™é›†ï¼ˆsupervised instruction fine-tuningï¼‰</li>
          <li>å°‡æŒ‡ä»¤è³‡æ–™çµ„æˆè¨“ç·´æ‰¹æ¬¡(Batching)</li>
          <li>è¼‰å…¥ä¸¦å¾®èª¿é è¨“ç·´æ¨¡å‹ä»¥éµå¾äººé¡æŒ‡ä»¤</li>
          <li>å¾æ¨¡å‹ä¸­æŠ½å–ç”Ÿæˆçµæœé€²è¡Œè©•ä¼°</li>
          <li>è©•ä¼°æŒ‡ä»¤å¾®èª¿å¾Œçš„æ¨¡å‹æ•ˆèƒ½</li>
        </ul>
      </div>
    </div>

    <!-- Slide 2: Three-Stage Architecture -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”</span>ä¸‰éšæ®µæ¶æ§‹</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.5rem;
          "
        >
          <img
            src="images/ch7_1.png"
            alt="ä¸‰éšæ®µæ¶æ§‹åœ–"
            style="
              max-width: 100%;
              max-height: 40vh;
              object-fit: contain;
              border-radius: 8px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            "
          />
        </div>

        <div style="display: flex; justify-content: space-between; gap: 1rem">
          <div
            style="
              flex: 1;
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3 style="color: #3498db; margin-top: 0">Stage 1: å»ºç«‹ LLM</h3>
            <ol>
              <li>æ•¸æ“šæº–å‚™èˆ‡æ¡æ¨£</li>
              <li>æ³¨æ„åŠ›æ©Ÿåˆ¶</li>
              <li>æ¶æ§‹è¨­è¨ˆ</li>
              <li>é è¨“ç·´</li>
            </ol>
          </div>

          <div
            style="
              flex: 1;
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3 style="color: #e74c3c; margin-top: 0">Stage 2: åŸºç¤æ¨¡å‹</h3>
            <ol>
              <li>è¨“ç·´è¿´åœˆ</li>
              <li>æ¨¡å‹è©•ä¼°</li>
              <li>è¼‰å…¥é è¨“ç·´æ¬Šé‡</li>
            </ol>
          </div>

          <div
            style="
              flex: 1;
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3 style="color: #2ecc71; margin-top: 0">Stage 3: å¾®èª¿ LLM</h3>
            <ol>
              <li>å¾®èª¿ç”¨æ–¼åˆ†é¡ï¼ˆå¦‚ç¬¬6ç« ï¼‰</li>
              <li>å¾®èª¿ç”¨æ–¼ç†è§£ä¸¦åŸ·è¡ŒæŒ‡ä»¤ï¼ˆæœ¬ç« ä¸»é¡Œï¼‰</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 3: Instruction Fine-tuning Concept -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ¯</span>Instruction Fine-tuning æ¦‚å¿µ</h2>

        <div style="display: flex; flex-direction: column; gap: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3 style="color: #3498db; margin-top: 0">é è¨“ç·´æ¨¡å‹çš„é™åˆ¶</h3>
            <p style="font-size: 1.2rem">
              é è¨“ç·´æ¨¡å‹å¯å®Œæˆ text completionï¼Œä½†ç„¡æ³•ç†è§£å…·é«”æŒ‡ä»¤ï¼Œå¦‚ï¼š
            </p>
            <div
              style="
                display: flex;
                justify-content: space-between;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  flex: 1;
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <p
                  style="
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                    font-size: 1.2rem;
                  "
                >
                  "è«‹ä¿®æ­£æ–‡æ³•"
                </p>
                <p style="color: #666; font-size: 0.9rem">
                  æ¨¡å‹ç„¡æ³•ç†è§£é€™æ˜¯ä¸€å€‹æŒ‡ä»¤
                </p>
              </div>
              <div
                style="
                  flex: 1;
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <p
                  style="
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                    font-size: 1.2rem;
                  "
                >
                  "å°‡é€™å¥è½‰æ›ç‚ºè¢«å‹•èªæ…‹"
                </p>
                <p style="color: #666; font-size: 0.9rem">
                  æ¨¡å‹ç„¡æ³•ç†è§£é€™æ˜¯ä¸€å€‹æŒ‡ä»¤
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3 style="color: #e74c3c; margin-top: 0">è§£æ±ºæ–¹æ¡ˆ</h3>
            <p style="font-size: 1.2rem">
              å› æ­¤éœ€è¦é€²è¡Œ
              <strong style="color: #e74c3c"
                >supervised instruction fine-tuning</strong
              >
            </p>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                margin-top: 1rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              "
            >
              <p style="margin-bottom: 0.5rem; font-size: 1.2rem">
                æœ¬ç« èšç„¦è®“ LLM ç†è§£ä¸¦ç”¢ç”Ÿç¬¦åˆäººé¡éœ€æ±‚çš„å›æ‡‰
              </p>
              <div
                style="display: flex; align-items: center; margin-top: 0.5rem"
              >
                <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”„</span>
                <p style="margin: 0; font-size: 1.2rem">
                  å¾ã€Œé æ¸¬ä¸‹ä¸€å€‹è©ã€åˆ°ã€Œç†è§£ä¸¦åŸ·è¡ŒæŒ‡ä»¤ã€
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 4: Examples -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ§ </span>æŒ‡ä»¤èˆ‡é æœŸå›æ‡‰ç¯„ä¾‹</h2>

        <div
          style="
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-bottom: 1.5rem;
          "
        >
          <p style="font-size: 1.2rem; margin-bottom: 1rem">
            ä»¥ä¸‹æ˜¯ä¸‰å€‹æŒ‡ä»¤å¾®èª¿çš„ç¯„ä¾‹ï¼Œå±•ç¤ºäº†æ¨¡å‹å¦‚ä½•å¾ã€Œé æ¸¬ä¸‹ä¸€å€‹è©ã€è½‰è®Šç‚ºã€Œç†è§£ä¸¦åŸ·è¡ŒæŒ‡ä»¤ã€ï¼š
          </p>
        </div>

        <div style="overflow-x: auto">
          <table
            style="
              width: 100%;
              border-collapse: separate;
              border-spacing: 0;
              border-radius: 8px;
              overflow: hidden;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            "
          >
            <thead>
              <tr>
                <th
                  style="
                    background-color: #3498db;
                    color: white;
                    padding: 1rem;
                    text-align: left;
                    width: 60%;
                  "
                >
                  æŒ‡ä»¤ (Instruction)
                </th>
                <th
                  style="
                    background-color: #3498db;
                    color: white;
                    padding: 1rem;
                    text-align: left;
                    width: 40%;
                  "
                >
                  é æœŸå›æ‡‰ (Expected Response)
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td
                  style="
                    padding: 1rem;
                    border-bottom: 1px solid #eee;
                    background-color: #f8f9fa;
                  "
                >
                  <div style="display: flex; align-items: center">
                    <span style="font-size: 1.1rem"
                      >Convert 45 kilometers to meters.</span
                    >
                  </div>
                </td>
                <td
                  style="
                    padding: 1rem;
                    border-bottom: 1px solid #eee;
                    background-color: #f8f9fa;
                  "
                >
                  <div style="display: flex; align-items: center">
                    <span style="font-size: 1.1rem">45000 meters</span>
                  </div>
                </td>
              </tr>
              <tr>
                <td style="padding: 1rem; border-bottom: 1px solid #eee">
                  <div style="display: flex; align-items: center">
                    <span style="font-size: 1.1rem"
                      >Provide a synonym for "bright."</span
                    >
                  </div>
                </td>
                <td style="padding: 1rem; border-bottom: 1px solid #eee">
                  <div style="display: flex; align-items: center">
                    <span style="font-size: 1.1rem">radiant</span>
                  </div>
                </td>
              </tr>
              <tr>
                <td style="padding: 1rem; background-color: #f8f9fa">
                  <div style="display: flex; align-items: center">
                    <span style="font-size: 1.1rem"
                      >Edit sentence to remove passive voice: "The song was
                      composed by the artist."</span
                    >
                  </div>
                </td>
                <td style="padding: 1rem; background-color: #f8f9fa">
                  <div style="display: flex; align-items: center">
                    <span style="font-size: 1.1rem"
                      >The artist composed the song.</span
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div
          style="
            margin-top: 1.5rem;
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
          "
        >
          <p style="font-size: 1.2rem; margin: 0">
            <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’¡</span>
            é€™äº›ç¯„ä¾‹å±•ç¤ºäº†æ¨¡å‹å¦‚ä½•å¾å–®ç´”çš„æ–‡æœ¬ç”Ÿæˆè½‰è®Šç‚ºèƒ½å¤ ç†è§£ä¸¦åŸ·è¡Œç‰¹å®šæŒ‡ä»¤çš„èƒ½åŠ›ã€‚
          </p>
        </div>
      </div>
    </div>

    <!-- Slide 5: Fine-tuning Process -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">âš™ï¸</span>Instruction fine-tuning ä¸‰éšæ®µæµç¨‹</h2>

        <div style="display: flex; flex-direction: column; gap: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
              margin-bottom: 1rem;
            "
          >
            <p style="font-size: 1.2rem; margin: 0">
              Instruction fine-tuning
              æ˜¯ä¸€å€‹ä¸‰éšæ®µçš„æµç¨‹ï¼Œå¾è³‡æ–™æº–å‚™åˆ°æ¨¡å‹è©•ä¼°ï¼Œæ¯å€‹éšæ®µéƒ½æœ‰æ˜ç¢ºçš„ç›®æ¨™å’Œä»»å‹™ã€‚
            </p>
          </div>

          <div style="display: flex; gap: 2rem; align-items: flex-start">
            <div style="flex: 2">
              <img
                src="images/fig7_3.PNG"
                alt="Instruction fine-tuning ä¸‰éšæ®µæµç¨‹"
                style="
                  width: 100%;
                  height: auto;
                  border-radius: 8px;
                  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                "
              />
            </div>

            <div
              style="flex: 1; display: flex; flex-direction: column; gap: 1rem"
            >
              <div
                style="
                  background-color: #f8f9fa;
                  padding: 1.2rem 1rem 0rem 1rem;
                  border-radius: 8px;
                  border-left: 4px solid #3498db;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h3
                  style="
                    color: #3498db;
                    margin-top: 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
                  >Stage 1: æº–å‚™è³‡æ–™é›†
                </h3>
                <ol
                  style="
                    margin-left: 1.5rem;
                    margin-top: 0.8rem;
                    font-size: 0.9rem;
                  "
                >
                  <li style="margin-bottom: 0.5rem">è³‡æ–™ä¸‹è¼‰èˆ‡æ ¼å¼æ•´ç†</li>
                  <li style="margin-bottom: 0.5rem">æ‰¹æ¬¡åŒ–ï¼ˆBatchingï¼‰</li>
                  <li>å»ºç«‹ DataLoader</li>
                </ol>
              </div>

              <div
                style="
                  background-color: #f8f9fa;
                  padding: 1.2rem 1rem 0rem 1rem;
                  border-radius: 8px;
                  border-left: 4px solid #e74c3c;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h3
                  style="
                    color: #e74c3c;
                    margin-top: 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”„</span
                  >Stage 2: å¾®èª¿æ¨¡å‹
                </h3>
                <ol
                  style="
                    margin-left: 1.5rem;
                    margin-top: 0.8rem;
                    font-size: 0.9rem;
                  "
                >
                  <li style="margin-bottom: 0.5rem">è¼‰å…¥é è¨“ç·´æ¨¡å‹</li>
                  <li style="margin-bottom: 0.5rem">
                    å¾®èª¿ LLMï¼ˆä½¿ç”¨æŒ‡ä»¤è³‡æ–™é›†ï¼‰
                  </li>
                  <li>è§€å¯Ÿ loss</li>
                </ol>
              </div>

              <div
                style="
                  background-color: #f8f9fa;
                  padding: 1.2rem 1rem 0rem 1rem;
                  border-radius: 8px;
                  border-left: 4px solid #2ecc71;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h3
                  style="
                    color: #2ecc71;
                    margin-top: 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“ˆ</span
                  >Stage 3: æ¨¡å‹è©•ä¼°
                </h3>
                <ol
                  style="
                    margin-left: 1.5rem;
                    margin-top: 0.8rem;
                    font-size: 0.9rem;
                  "
                >
                  <li style="margin-bottom: 0.5rem">æ“·å–å›æ‡‰</li>
                  <li style="margin-bottom: 0.5rem">è³ªæ€§åˆ†æ</li>
                  <li>è©•åˆ†</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 6: Code Example -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ’»</span>ç°¡æ˜“æŒ‡ä»¤å¾®èª¿ç¨‹å¼ç¢¼</h2>
        <pre><code class="language-python">from transformers import AutoTokenizer, AutoModelForCausalLM, Trainer, TrainingArguments, DataCollatorForSeq2Seq
from datasets import load_dataset

# ä¸‹è¼‰ tokenizer èˆ‡æ¨¡å‹
model_name = "gpt2"
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(model_name)

# å‡è¨­ä½ æœ‰æŒ‡ä»¤è³‡æ–™é›† (instruction + response)
dataset = load_dataset("json", data_files="instruction_dataset.json")

# è³‡æ–™æ ¼å¼è½‰æ›
def preprocess(example):
    prompt = f"Instruction: {example['instruction']}\nResponse:"
    inputs = tokenizer(prompt, truncation=True, padding="max_length", max_length=512)
    labels = tokenizer(example['response'], truncation=True, padding="max_length", max_length=512)
    inputs["labels"] = labels["input_ids"]
    return inputs

tokenized_dataset = dataset.map(preprocess)

# è¨“ç·´è¨­å®š
training_args = TrainingArguments(
    output_dir="./results",
    per_device_train_batch_size=2,
    num_train_epochs=3,
    logging_dir="./logs",
    save_strategy="epoch"
)

# Trainer åˆå§‹åŒ–
trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=tokenized_dataset["train"],
    tokenizer=tokenizer,
    data_collator=DataCollatorForSeq2Seq(tokenizer, model=model)
)

# é–‹å§‹è¨“ç·´
trainer.train()</code></pre>
      </div>
    </div>

    <!-- Slide 7: Data Download -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸŒ</span>è³‡æ–™ä¸‹è¼‰æ–¹å¼</h2>
        <h3>ä¸‹è¼‰è³‡æ–™é›†ï¼š</h3>
        <pre><code class="language-python">import json, os, urllib.request
      
      def download_and_load_file(file_path, url):
          if not os.path.exists(file_path):
              with urllib.request.urlopen(url) as response:
                  text_data = response.read().decode("utf-8")
                  with open(file_path, "w", encoding="utf-8") as file:
                      file.write(text_data)
          with open(file_path, "r", encoding="utf-8") as file:
              text_data = file.read()
              data = json.loads(text_data)
          return data
      
      file_path = "instruction-data.json"
      url = "https://raw.githubusercontent.com/rasbt/LLMs-from-scratch/main/ch07/01_main-chapter-code/instruction-data.json"
      
      data = download_and_load_file(file_path, url)
      print("Number of entries:", len(data))</code></pre>
      </div>
    </div>

    <!-- Slide 8: Data Format -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ“¦</span>è³‡æ–™é›†æ ¼å¼</h2>

        <div style="display: flex; flex-direction: column; gap: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <p style="font-size: 1.2rem; margin: 0">
              æ¯ç­†è³‡æ–™æ˜¯ JSON æ ¼å¼çš„å­—å…¸ï¼ŒåŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š
            </p>
          </div>

          <div style="display: flex; flex-direction: column; gap: 1.5rem">
            <div
              style="
                flex: 1;
                background-color: #f8f9fa;
                padding: 1.2rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              "
            >
              <h3
                style="
                  color: #3498db;
                  margin-top: 0;
                  display: flex;
                  align-items: center;
                "
              >
                <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“</span
                >åŸºæœ¬æ ¼å¼
              </h3>
              <pre
                style="
                  margin-top: 1rem;
                  background-color: #282c34;
                  border-radius: 6px;
                "
              ><code class="language-json">{
  "instruction": "Identify the correct spelling of the following word.",
  "input": "Occasion",
  "output": "The correct spelling is 'Occasion.'"
}</code></pre>
            </div>

            <div
              style="
                flex: 1;
                background-color: #f8f9fa;
                padding: 1.2rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              "
            >
              <h3
                style="
                  color: #e74c3c;
                  margin-top: 0;
                  display: flex;
                  align-items: center;
                "
              >
                <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’¡</span
                >ç©ºè¼¸å…¥ç¯„ä¾‹
              </h3>
              <pre
                style="
                  margin-top: 1rem;
                  background-color: #282c34;
                  border-radius: 6px;
                "
              ><code class="language-json">{
  "instruction": "What is an antonym of 'complicated'?",
  "input": "",
  "output": "An antonym of 'complicated' is 'simple.'"
}</code></pre>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <p style="font-size: 1.2rem; margin: 0">
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’¡</span>
              æ³¨æ„ï¼š<code>input</code>
              æ¬„ä½å¯èƒ½ç‚ºç©ºå­—ä¸²ï¼Œé€™è¡¨ç¤ºæŒ‡ä»¤æœ¬èº«å·²åŒ…å«è¶³å¤ è³‡è¨Šï¼Œç„¡éœ€é¡å¤–è¼¸å…¥ã€‚
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 9: Prompt Format -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ§¾</span>Prompt æ ¼å¼è½‰æ›</h2>

        <div style="display: flex; flex-direction: column; gap: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”§</span
              >ç‚ºä»€éº¼éœ€è¦è½‰æ›æ ¼å¼ï¼Ÿ
            </h3>
            <p style="font-size: 1.2rem; margin: 0.5rem 0">
              å°‡ prompt è½‰æ›æˆç‰¹å®šæ ¼å¼ï¼ˆå¦‚ Alpaca æˆ– Phi-3ï¼‰ä¸»è¦æ˜¯ç‚ºäº†ï¼š
            </p>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 0.8rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #3498db;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">1ï¸âƒ£</span
                  >ç¬¦åˆæ¨¡å‹è¨“ç·´æ™‚çš„æ ¼å¼æœŸæœ›
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ä¿æŒèˆ‡åŸå§‹è¨“ç·´æ™‚çš„ä¸€è‡´æ€§ï¼Œè®“æ¨¡å‹æ›´å®¹æ˜“ç†è§£æŒ‡ä»¤æ„åœ–
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">2ï¸âƒ£</span
                  >æé«˜å¾®èª¿æ•ˆæœ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åŠ å¿«æ”¶æ–‚é€Ÿåº¦ï¼Œé¿å…æ¨¡å‹èª¤è§£ prompt æ„åœ–ï¼Œæå‡ç”¢å‡ºå“è³ª
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">3ï¸âƒ£</span
                  >æ¨™æº–åŒ–è³‡æ–™è™•ç†æµç¨‹
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  æ–¹ä¾¿ä½¿ç”¨é–‹æºæ¡†æ¶ï¼ˆå¦‚ HuggingFace Transformersã€LoRA
                  å¾®èª¿å·¥å…·ç­‰ï¼‰
                </p>
              </div>
            </div>
          </div>

          <div style="display: flex; flex-direction: column; gap: 1.5rem">
            <div
              style="
                flex: 1;
                background-color: #f8f9fa;
                padding: 1.2rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              "
            >
              <h3
                style="
                  color: #3498db;
                  margin-top: 0;
                  display: flex;
                  align-items: center;
                "
              >
                <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“</span
                >Alpaca é¢¨æ ¼
              </h3>
              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  margin-bottom: 0.8rem;
                "
              >
                <p style="margin: 0; font-size: 1.1rem; color: #666">
                  åŸºæ–¼ Stanford Alpaca çš„å¾®èª¿è³‡æ–™é›†æ ¼å¼
                </p>
              </div>
              <pre
                style="
                  margin-top: 0.5rem;
                  background-color: #282c34;
                  border-radius: 6px;
                "
              ><code class="language-text">Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:
Identify the correct spelling of the following word.

### Input:
Occasion

### Response:
The correct spelling is 'Occasion.'</code></pre>
            </div>

            <div
              style="
                flex: 1;
                background-color: #f8f9fa;
                padding: 1.2rem;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              "
            >
              <h3
                style="
                  color: #e74c3c;
                  margin-top: 0;
                  display: flex;
                  align-items: center;
                "
              >
                <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’¬</span
                >Phi-3 é¢¨æ ¼ï¼ˆç°¡æ½”ç‰ˆï¼‰
              </h3>
              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  margin-bottom: 0.8rem;
                "
              >
                <p style="margin: 0; font-size: 1.1rem; color: #666">
                  Microsoft çš„ Phi-3 ä½¿ç”¨é¡ä¼¼ OpenAI çš„èŠå¤©æ ¼å¼
                </p>
              </div>
              <pre
                style="
                  margin-top: 0.5rem;
                  background-color: #282c34;
                  border-radius: 6px;
                "
              ><code class="language-text">&lt;|user|&gt;
Identify the correct spelling of the following word: Occasion
&lt;|assistant|&gt;
The correct spelling is 'Occasion.'</code></pre>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >æ ¼å¼é¸æ“‡å»ºè­°
            </h3>
            <table
              style="
                width: 100%;
                margin-top: 0.5rem;
                border-collapse: separate;
                border-spacing: 0;
                border-radius: 6px;
                overflow: hidden;
              "
            >
              <thead>
                <tr>
                  <th
                    style="
                      width: 30%;
                      background-color: #2ecc71;
                      color: white;
                      padding: 0.8rem;
                    "
                  >
                    æ¨¡å‹
                  </th>
                  <th
                    style="
                      width: 30%;
                      background-color: #2ecc71;
                      color: white;
                      padding: 0.8rem;
                    "
                  >
                    å»ºè­°æ ¼å¼
                  </th>
                  <th
                    style="
                      width: 40%;
                      background-color: #2ecc71;
                      color: white;
                      padding: 0.8rem;
                    "
                  >
                    é©ç”¨å ´æ™¯
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 0.8rem; background-color: white">
                    Alpaca
                  </td>
                  <td style="padding: 0.8rem; background-color: white">
                    <code>instruction</code>/<code>input</code>/<code
                      >output</code
                    >
                  </td>
                  <td style="padding: 0.8rem; background-color: white">
                    å–®è¼ªæŒ‡ä»¤ä»»å‹™
                  </td>
                </tr>
                <tr>
                  <td style="padding: 0.8rem; background-color: #f8f9fa">
                    Phi-3
                  </td>
                  <td style="padding: 0.8rem; background-color: #f8f9fa">
                    <code>messages</code> (chat æ ¼å¼)
                  </td>
                  <td style="padding: 0.8rem; background-color: #f8f9fa">
                    å¤šè¼ªå°è©±èˆ‡æ›´è‡ªç„¶èªå¢ƒä»»å‹™
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 10: Format Input Function -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”§</span>Prompt æ ¼å¼åŒ–å‡½æ•¸</h2>
        <h3>format_input å‡½æ•¸ï¼š</h3>
        <pre><code class="language-python">def format_input(entry):
    instruction_text = (
        f"Below is an instruction that describes a task. "
        f"Write a response that appropriately completes the request.\n"
        f"\n### Instruction:\n{entry['instruction']}"
    )
    
    input_text = f"\n\n### Input:\n{entry['input']}" if entry["input"] else ""
    return instruction_text + input_text</code></pre>

        <h3>ç”¨æ³•ï¼š</h3>
        <pre><code class="language-python">model_input = format_input(data[50])
desired_response = f"\n\n### Response:\n{data[50]['output']}"
print(model_input + desired_response)</code></pre>

        <h3>è¼¸å‡ºçµæœï¼š</h3>
        <pre><code class="language-text">Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:
Identify the correct spelling of the following word.

### Input:
Occasion

### Response:
The correct spelling is 'Occasion.'</code></pre>
      </div>
    </div>

    <!-- Slide 11: Data Splitting -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”¢</span>è³‡æ–™é›†åˆ‡å‰²</h2>

        <div style="display: flex; flex-direction: column; gap: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >è³‡æ–™åˆ†å‰²æ¯”ä¾‹
            </h3>
            <div
              style="
                display: flex;
                justify-content: space-between;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  flex: 1;
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                  text-align: center;
                "
              >
                <h4 style="color: #3498db; margin: 0 0 0.5rem 0">è¨“ç·´é›†</h4>
                <div style="font-size: 2rem; font-weight: bold; color: #3498db">
                  85%
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666">
                  ç”¨æ–¼æ¨¡å‹è¨“ç·´
                </p>
              </div>

              <div
                style="
                  flex: 1;
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                  text-align: center;
                "
              >
                <h4 style="color: #e74c3c; margin: 0 0 0.5rem 0">é©—è­‰é›†</h4>
                <div style="font-size: 2rem; font-weight: bold; color: #e74c3c">
                  5%
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666">
                  ç”¨æ–¼èª¿æ•´è¶…åƒæ•¸
                </p>
              </div>

              <div
                style="
                  flex: 1;
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                  text-align: center;
                "
              >
                <h4 style="color: #2ecc71; margin: 0 0 0.5rem 0">æ¸¬è©¦é›†</h4>
                <div style="font-size: 2rem; font-weight: bold; color: #2ecc71">
                  10%
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666">
                  ç”¨æ–¼æœ€çµ‚è©•ä¼°
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >è³‡æ–™åˆ†å‰²ç¨‹å¼ç¢¼
            </h3>
            <div
              style="
                background-color: white;
                padding: 0.8rem;
                border-radius: 6px;
                margin-bottom: 0.8rem;
              "
            >
              <p style="margin: 0; font-size: 1.1rem; color: #666">
                ä½¿ç”¨ Python é€²è¡Œè³‡æ–™é›†åˆ‡å‰²
              </p>
            </div>
            <pre
              style="
                margin-top: 0.5rem;
                background-color: #282c34;
                border-radius: 6px;
              "
            ><code class="language-python">train_portion = int(len(data) * 0.85)
test_portion = int(len(data) * 0.1)
val_portion = len(data) - train_portion - test_portion

train_data = data[:train_portion]
test_data = data[train_portion:train_portion + test_portion]
val_data = data[train_portion + test_portion:]

print("Training set length:", len(train_data))
print("Validation set length:", len(val_data))
print("Test set length:", len(test_data))</code></pre>
          </div>

          <!-- <div
            style="
              background-color: #f8f9fa;
              padding: 1rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“</span
              >åˆ†å‰²æ³¨æ„äº‹é …
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 0.8rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">1ï¸âƒ£</span
                  >éš¨æ©Ÿæ€§
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ç¢ºä¿è³‡æ–™é›†åœ¨åˆ†å‰²å‰å·²ç¶“éš¨æ©Ÿæ‰“äº‚ï¼Œé¿å…è³‡æ–™åˆ†å¸ƒä¸å‡
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">2ï¸âƒ£</span
                  >æ¯”ä¾‹é¸æ“‡
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  æ ¹æ“šè³‡æ–™é›†å¤§å°å’Œä»»å‹™éœ€æ±‚èª¿æ•´åˆ†å‰²æ¯”ä¾‹ï¼Œå°è³‡æ–™é›†å¯èƒ½éœ€è¦æ›´å¤§çš„é©—è­‰/æ¸¬è©¦é›†æ¯”ä¾‹
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 0.8rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">3ï¸âƒ£</span
                  >è³‡æ–™å¹³è¡¡
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ç¢ºä¿å„é¡åˆ¥åœ¨è¨“ç·´ã€é©—è­‰å’Œæ¸¬è©¦é›†ä¸­éƒ½æœ‰é©ç•¶çš„ä»£è¡¨æ€§
                </p>
              </div>
            </div>
          </div> -->
        </div>
      </div>
    </div>

    <!-- Slide 12: Organizing Data into Training Batches -->
    <div class="slide">
      <div class="slide-content">
        <h2>
          <span class="emoji">ğŸ“¦</span>7.3 é‡é»æ•´ç†ï¼šOrganizing Data into
          Training Batches
        </h2>

        <div style="display: flex; flex-direction: column; gap: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ¯</span
              >ä¸»è¦ç›®æ¨™
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              å°‡ instruction dataset ä¸­çš„å¤šç­†æ¨£æœ¬çµ„åˆæˆè¨“ç·´
              batchesï¼Œä¸¦è£½ä½œå°æ‡‰çš„
              <strong style="color: #3498db">input token IDs</strong> å’Œ
              <strong style="color: #e74c3c">target token IDs</strong
              >ï¼Œè®“æ¨¡å‹å­¸ç¿’è¼¸å‡ºé æœŸçµæœã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”„</span
              >è™•ç†æµç¨‹
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 1rem">
                <div
                  style="
                    background-color: #2ecc71;
                    color: white;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-weight: bold;
                    flex-shrink: 0;
                  "
                >
                  1
                </div>
                <div
                  style="
                    background-color: white;
                    padding: 1rem;
                    border-radius: 6px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    flex-grow: 1;
                  "
                >
                  <h4 style="color: #2ecc71; margin: 0 0 0.5rem 0">è³‡æ–™æº–å‚™</h4>
                  <p style="margin: 0; font-size: 1.1rem">
                    å¾è³‡æ–™é›†ä¸­æå–æŒ‡ä»¤ã€è¼¸å…¥å’Œè¼¸å‡ºæ–‡æœ¬
                  </p>
                </div>
              </div>

              <div style="display: flex; align-items: flex-start; gap: 1rem">
                <div
                  style="
                    background-color: #2ecc71;
                    color: white;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-weight: bold;
                    flex-shrink: 0;
                  "
                >
                  2
                </div>
                <div
                  style="
                    background-color: white;
                    padding: 1rem;
                    border-radius: 6px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    flex-grow: 1;
                  "
                >
                  <h4 style="color: #2ecc71; margin: 0 0 0.5rem 0">æ ¼å¼è½‰æ›</h4>
                  <p style="margin: 0; font-size: 1.1rem">
                    å°‡æ–‡æœ¬è½‰æ›ç‚ºæ¨¡å‹æ‰€éœ€çš„ç‰¹å®šæ ¼å¼ï¼ˆå¦‚Alpacaæˆ–Phi-3æ ¼å¼ï¼‰
                  </p>
                </div>
              </div>

              <div style="display: flex; align-items: flex-start; gap: 1rem">
                <div
                  style="
                    background-color: #2ecc71;
                    color: white;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-weight: bold;
                    flex-shrink: 0;
                  "
                >
                  3
                </div>
                <div
                  style="
                    background-color: white;
                    padding: 1rem;
                    border-radius: 6px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    flex-grow: 1;
                  "
                >
                  <h4 style="color: #2ecc71; margin: 0 0 0.5rem 0">åˆ†è©è™•ç†</h4>
                  <p style="margin: 0; font-size: 1.1rem">
                    ä½¿ç”¨tokenizerå°‡æ–‡æœ¬è½‰æ›ç‚ºtoken IDs
                  </p>
                </div>
              </div>

              <div style="display: flex; align-items: flex-start; gap: 1rem">
                <div
                  style="
                    background-color: #2ecc71;
                    color: white;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-weight: bold;
                    flex-shrink: 0;
                  "
                >
                  4
                </div>
                <div
                  style="
                    background-color: white;
                    padding: 1rem;
                    border-radius: 6px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    flex-grow: 1;
                  "
                >
                  <h4 style="color: #2ecc71; margin: 0 0 0.5rem 0">æ‰¹æ¬¡çµ„è£</h4>
                  <p style="margin: 0; font-size: 1.1rem">
                    å°‡å¤šå€‹æ¨£æœ¬çµ„åˆæˆå›ºå®šå¤§å°çš„è¨“ç·´æ‰¹æ¬¡
                  </p>
                </div>
              </div>

              <div style="display: flex; align-items: flex-start; gap: 1rem">
                <div
                  style="
                    background-color: #2ecc71;
                    color: white;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-weight: bold;
                    flex-shrink: 0;
                  "
                >
                  5
                </div>
                <div
                  style="
                    background-color: white;
                    padding: 1rem;
                    border-radius: 6px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    flex-grow: 1;
                  "
                >
                  <h4 style="color: #2ecc71; margin: 0 0 0.5rem 0">æº–å‚™ç›®æ¨™</h4>
                  <p style="margin: 0; font-size: 1.1rem">
                    ç‚ºæ¯å€‹æ‰¹æ¬¡æº–å‚™å°æ‡‰çš„ç›®æ¨™token IDsï¼Œç”¨æ–¼ç›£ç£å­¸ç¿’
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 13: Batching Five Steps -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”</span>Batching äº”æ­¥é©Ÿ</h2>

        <div
          style="
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
          "
        >
          <h3
            style="
              color: #e74c3c;
              margin-top: 0;
              display: flex;
              align-items: center;
            "
          >
            <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’¡</span
            >é‡è¦èªªæ˜
          </h3>
          <p style="font-size: 1.1rem; line-height: 1.5">
            åœ¨ç›£ç£å¼å¾®èª¿ä¸­ï¼Œæˆ‘å€‘å¸Œæœ›æ¨¡å‹èƒ½å¤ æ ¹æ“šè¼¸å…¥ç”Ÿæˆæ­£ç¢ºçš„è¼¸å‡ºã€‚é€šéå°‡è¼¸å…¥åºåˆ—å³ç§»ä¸€æ ¼ä½œç‚ºç›®æ¨™åºåˆ—ï¼Œæ¨¡å‹å­¸ç¿’é æ¸¬ä¸‹ä¸€å€‹tokenï¼Œé€™æ˜¯è‡ªè¿´æ­¸èªè¨€æ¨¡å‹çš„æ ¸å¿ƒè¨“ç·´æ–¹å¼ã€‚
          </p>
        </div>

        <div style="display: flex; gap: 2rem; margin-top: 1.5rem">
          <!-- å·¦ä¾§å›¾ç‰‡ -->
          <div
            style="
              flex: 2;
              display: flex;
              flex-direction: column;
              align-items: center;
            "
          >
            <div
              style="
                background-color: #f8f9fa;
                padding: 1rem;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                width: 100%;
              "
            >
              <img
                src="images/fig7_6.PNG"
                alt="Batching äº”æ­¥é©Ÿ"
                style="width: 100%; border-radius: 4px"
              />
            </div>
            <p
              style="
                margin-top: 0.8rem;
                font-size: 0.9rem;
                color: #666;
                text-align: center;
              "
            >
              åœ–7.6: Batchingè™•ç†æµç¨‹åœ–
            </p>
          </div>

          <!-- å³ä¾§è¯´æ˜æ–‡å­— -->
          <div
            style="flex: 1; display: flex; flex-direction: column; gap: 1rem"
          >
            <div
              style="
                background-color: #f8f9fa;
                padding: 1.5rem;
                border-radius: 8px;
                border-left: 4px solid #3498db;
              "
            >
              <h3
                style="
                  color: #3498db;
                  margin-top: 0;
                  display: flex;
                  align-items: center;
                "
              >
                <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“</span
                >Batchingè™•ç†æ­¥é©Ÿ
              </h3>
              <div
                style="
                  display: flex;
                  flex-direction: column;
                  gap: 1rem;
                  margin-top: 1rem;
                "
              >
                <div style="display: flex; align-items: flex-start; gap: 1rem">
                  <div
                    style="
                      background-color: #3498db;
                      color: white;
                      width: 30px;
                      height: 30px;
                      border-radius: 50%;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      font-weight: bold;
                      flex-shrink: 0;
                    "
                  >
                    1
                  </div>
                  <div
                    style="
                      background-color: white;
                      padding: 1rem;
                      border-radius: 6px;
                      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                      flex-grow: 1;
                    "
                  >
                    <h4 style="color: #3498db; margin: 0 0 0.5rem 0">
                      æ ¼å¼åŒ–è¼¸å…¥æ–‡å­—
                    </h4>
                    <p style="margin: 0; font-size: 1.1rem">
                      instruction + input + responseï¼ˆç”¨templateæ‹¼æ¥ï¼‰
                    </p>
                  </div>
                </div>

                <div style="display: flex; align-items: flex-start; gap: 1rem">
                  <div
                    style="
                      background-color: #3498db;
                      color: white;
                      width: 30px;
                      height: 30px;
                      border-radius: 50%;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      font-weight: bold;
                      flex-shrink: 0;
                    "
                  >
                    2
                  </div>
                  <div
                    style="
                      background-color: white;
                      padding: 1rem;
                      border-radius: 6px;
                      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                      flex-grow: 1;
                    "
                  >
                    <h4 style="color: #3498db; margin: 0 0 0.5rem 0">
                      Tokenizerç·¨ç¢¼æ–‡å­—
                    </h4>
                    <p style="margin: 0; font-size: 1.1rem">
                      å°‡æ–‡æœ¬è½‰æ›ç‚ºtoken IDsåºåˆ—
                    </p>
                  </div>
                </div>

                <div style="display: flex; align-items: flex-start; gap: 1rem">
                  <div
                    style="
                      background-color: #3498db;
                      color: white;
                      width: 30px;
                      height: 30px;
                      border-radius: 50%;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      font-weight: bold;
                      flex-shrink: 0;
                    "
                  >
                    3
                  </div>
                  <div
                    style="
                      background-color: white;
                      padding: 1rem;
                      border-radius: 6px;
                      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                      flex-grow: 1;
                    "
                  >
                    <h4 style="color: #3498db; margin: 0 0 0.5rem 0">
                      è£œé½Špadding
                    </h4>
                    <p style="margin: 0; font-size: 1.1rem">
                      ä½¿ç”¨50256 (<code>&lt;|endoftext|&gt;</code>) ä½œç‚ºpadding
                      token
                    </p>
                  </div>
                </div>

                <div style="display: flex; align-items: flex-start; gap: 1rem">
                  <div
                    style="
                      background-color: #3498db;
                      color: white;
                      width: 30px;
                      height: 30px;
                      border-radius: 50%;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      font-weight: bold;
                      flex-shrink: 0;
                    "
                  >
                    4
                  </div>
                  <div
                    style="
                      background-color: white;
                      padding: 1rem;
                      border-radius: 6px;
                      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                      flex-grow: 1;
                    "
                  >
                    <h4 style="color: #3498db; margin: 0 0 0.5rem 0">
                      è£½ä½œtarget tokens
                    </h4>
                    <p style="margin: 0; font-size: 1.1rem">
                      å°input IDså³ç§»ä¸€æ ¼ + çµå°¾åŠ padding
                    </p>
                  </div>
                </div>

                <div style="display: flex; align-items: flex-start; gap: 1rem">
                  <div
                    style="
                      background-color: #3498db;
                      color: white;
                      width: 30px;
                      height: 30px;
                      border-radius: 50%;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      font-weight: bold;
                      flex-shrink: 0;
                    "
                  >
                    5
                  </div>
                  <div
                    style="
                      background-color: white;
                      padding: 1rem;
                      border-radius: 6px;
                      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                      flex-grow: 1;
                    "
                  >
                    <h4 style="color: #3498db; margin: 0 0 0.5rem 0">
                      è½‰æ›padding tokens
                    </h4>
                    <p style="margin: 0; font-size: 1.1rem">
                      å°‡padding tokensè½‰ç‚º-100ï¼Œè¢«PyTorchå¿½ç•¥
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 14: Ignoring -100 -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ¯</span>ignore_index=-100 çš„ç”¨é€”èˆ‡ç­–ç•¥</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >PyTorch é è¨­åƒæ•¸
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #3498db">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">torch.nn.functional.cross_entropy(
    input, target, weight=None, size_average=None, 
    ignore_index=-100, reduce=None, reduction='mean'
)</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ¯</span
              >å¿½ç•¥ -100 çš„ç›®çš„
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">1ï¸âƒ£</span
                  >è·³é padding tokens
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åœ¨è¨ˆç®— loss æ™‚ï¼Œæˆ‘å€‘ä¸å¸Œæœ›æ¨¡å‹å­¸ç¿’é æ¸¬ padding
                  tokensï¼Œå› æ­¤å°‡å®ƒå€‘æ¨™è¨˜ç‚º -100ï¼Œä½¿å…¶ä¸åƒèˆ‡ loss è¨ˆç®—ã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">2ï¸âƒ£</span
                  >å¯é¸ï¼šè·³é instruction/input tokens
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å¯èƒ½åªæƒ³è®“æ¨¡å‹å­¸ç¿’é æ¸¬ response
                  éƒ¨åˆ†ï¼Œè€Œä¸å­¸ç¿’é æ¸¬ instruction å’Œ input éƒ¨åˆ†ã€‚
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">âš ï¸</span
              >ç‰¹æ®Šè™•ç†ï¼štoken ID 50256
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <p style="margin: 0; font-size: 1.1rem">
                åœ¨ GPT-2 ä¸­ï¼Œtoken ID 50256 æ˜¯
                <code>&lt;|endoftext|&gt;</code> tokenï¼Œæˆ‘å€‘å°‡å…¶ç”¨ä½œ padding
                tokenã€‚åœ¨ target åºåˆ—ä¸­ï¼Œæˆ‘å€‘å°‡é™¤äº†ç¬¬ä¸€å€‹ä»¥å¤–çš„æ‰€æœ‰ padding
                tokens æ¨™è¨˜ç‚º -100ï¼Œé€™æ¨£æ¨¡å‹å°±ä¸æœƒå­¸ç¿’é æ¸¬å®ƒå€‘ã€‚
              </p>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #9b59b6;
            "
          >
            <h3
              style="
                color: #9b59b6;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >è¦–è¦ºåŒ–ç¯„ä¾‹
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“Š</span
                  >Input IDs vs Target IDs
                </h4>
                <div
                  style="
                    display: flex;
                    flex-direction: column;
                    gap: 0.5rem;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  <div
                    style="
                      background-color: #f1f1f1;
                      padding: 0.8rem;
                      border-radius: 4px;
                    "
                  >
                    <strong>Input IDs:</strong> [0, 1, 2, 3, 4, 50256, 50256,
                    50256]
                  </div>
                  <div
                    style="
                      background-color: #f1f1f1;
                      padding: 0.8rem;
                      border-radius: 4px;
                    "
                  >
                    <strong>Target IDs:</strong> [1, 2, 3, 4, 50256, -100, -100,
                    -100]
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 15: Dataset Class Implementation -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ“š</span>Dataset é¡åˆ¥å¯¦ä½œ</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“‹</span
              >InstructionDataset é¡åˆ¥
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              é€™å€‹é¡åˆ¥è² è²¬å°‡æŒ‡ä»¤æ•¸æ“šè½‰æ›ç‚ºæ¨¡å‹å¯ç”¨çš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ ¼å¼åŒ–è¼¸å…¥æ–‡æœ¬å’Œå°å…¶é€²è¡Œç·¨ç¢¼ã€‚
            </p>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #3498db">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">import torch
from torch.utils.data import Dataset

class InstructionDataset(Dataset):
    def __init__(self, data, tokenizer):
        self.data = data
        self.tokenizer = tokenizer
        self.encoded_texts = []
        for entry in data:
            instruction_plus_input = format_input(entry)
            response = f"\n\n### Response:\n{entry['output']}"
            full_text = instruction_plus_input + response
            self.encoded_texts.append(tokenizer.encode(full_text))

    def __getitem__(self, index):
        return self.encoded_texts[index]

    def __len__(self):
        return len(self.data)</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >é¡åˆ¥åŠŸèƒ½è§£æ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">1ï¸âƒ£</span
                  >åˆå§‹åŒ–æ–¹æ³•
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åœ¨åˆå§‹åŒ–æ™‚ï¼Œéæ­·æ‰€æœ‰æ•¸æ“šæ¢ç›®ï¼Œå°‡æ¯å€‹æ¢ç›®æ ¼å¼åŒ–ç‚ºæŒ‡ä»¤åŠ è¼¸å…¥çš„å½¢å¼ï¼Œç„¶å¾Œæ·»åŠ å›æ‡‰éƒ¨åˆ†ï¼Œæœ€å¾Œä½¿ç”¨tokenizerå°å®Œæ•´æ–‡æœ¬é€²è¡Œç·¨ç¢¼ã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">2ï¸âƒ£</span
                  >ç²å–æ•¸æ“šæ–¹æ³•
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  <code>__getitem__</code> æ–¹æ³•è¿”å›æŒ‡å®šç´¢å¼•çš„ç·¨ç¢¼æ–‡æœ¬ï¼Œ<code
                    >__len__</code
                  >
                  æ–¹æ³•è¿”å›æ•¸æ“šé›†çš„ç¸½é•·åº¦ï¼Œé€™å…©å€‹æ–¹æ³•æ˜¯PyTorch
                  Datasetæ¥å£çš„å¿…è¦å¯¦ç¾ã€‚
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >æ•¸æ“šæ ¼å¼ç¤ºä¾‹
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“</span
                  >åŸå§‹æ•¸æ“š
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  <pre style="margin: 0"><code class="language-json">{
  "instruction": "Convert the active sentence to passive",
  "input": "The chef cooks the meal every day.",
  "output": "The meal is cooked by the chef every day."
}</code></pre>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ”„</span
                  >æ ¼å¼åŒ–å¾Œ
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  <pre
                    style="margin: 0"
                  ><code class="language-text">Convert the active sentence to passive: 'The chef cooks the meal every day.'

### Response:
The meal is cooked by the chef every day.</code></pre>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ”¢</span
                  >ç·¨ç¢¼å¾Œ
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  <pre
                    style="margin: 0"
                  ><code class="language-python">[token_ids...]  # å¯¦éš›çš„token IDåºåˆ—</code></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 16: Collate Function Introduction -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”„</span>Collate Function ä»‹ç´¹</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“‹</span
              >Collate Function çš„ä½œç”¨
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              Collate Function
              è² è²¬å°‡å¤šå€‹æ•¸æ“šæ¨£æœ¬çµ„åˆæˆä¸€å€‹æ‰¹æ¬¡ï¼ˆbatchï¼‰ï¼Œè™•ç†ä¸åŒé•·åº¦çš„åºåˆ—ï¼Œä¸¦æº–å‚™è¼¸å…¥å’Œç›®æ¨™å¼µé‡ã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”„</span
              >åˆç‰ˆ Collate Function
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #2ecc71">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">def custom_collate_draft_1(batch, pad_token_id=50256, device="cpu"):
    batch_max_length = max(len(item)+1 for item in batch)
    inputs_list = []

    for item in batch:
        new_item = item.copy()
        new_item += [pad_token_id]
        padded = new_item + [pad_token_id] * (batch_max_length - len(new_item))
        inputs = torch.tensor(padded[:-1])
        inputs_list.append(inputs)

    inputs_tensor = torch.stack(inputs_list).to(device)
    return inputs_tensor</code></pre>
              </div>
            </div>
            <p style="font-size: 1.1rem; line-height: 1.5; margin-top: 1rem">
              åˆç‰ˆ Collate Function
              åªè™•ç†äº†è¼¸å…¥åºåˆ—çš„å¡«å……ï¼Œæ²’æœ‰è™•ç†ç›®æ¨™åºåˆ—å’Œå¿½ç•¥ç´¢å¼•ã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">âœ…</span
              >æœ€çµ‚ Collate Function
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #e74c3c">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">def custom_collate_fn(
    batch,
    pad_token_id=50256,
    ignore_index=-100,
    allowed_max_length=None,
    device="cpu"
):
    batch_max_length = max(len(item)+1 for item in batch)
    inputs_list, targets_list = [], []

    for item in batch:
        new_item = item.copy()
        new_item += [pad_token_id]  # åŠ ä¸€å€‹ padding ä½œç‚ºæœ«ç«¯ token

        padded = new_item + [pad_token_id] * (batch_max_length - len(new_item))
        inputs = torch.tensor(padded[:-1])
        targets = torch.tensor(padded[1:])  # å³ç§»ä¸€ä½ä½œç‚º target

        # å°‡æ‰€æœ‰ padding token æ¨™è¨˜ç‚º -100ï¼ˆignore lossï¼‰ï¼Œä½†ä¿ç•™ç¬¬ä¸€å€‹
        mask = targets == pad_token_id
        indices = torch.nonzero(mask).squeeze()
        if indices.numel() > 1:
            targets[indices[1:]] = ignore_index

        if allowed_max_length is not None:
            inputs = inputs[:allowed_max_length]
            targets = targets[:allowed_max_length]

        inputs_list.append(inputs)
        targets_list.append(targets)

    inputs_tensor = torch.stack(inputs_list).to(device)
    targets_tensor = torch.stack(targets_list).to(device)
    return inputs_tensor, targets_tensor</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #9b59b6;
            "
          >
            <h3
              style="
                color: #9b59b6;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >é—œéµåŠŸèƒ½è§£æ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">1ï¸âƒ£</span
                  >å¡«å……è™•ç†
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  å°‡ä¸åŒé•·åº¦çš„åºåˆ—å¡«å……åˆ°æ‰¹æ¬¡ä¸­æœ€é•·åºåˆ—çš„é•·åº¦ï¼Œä½¿ç”¨
                  <code>pad_token_id</code>ï¼ˆé»˜èªç‚º 50256ï¼‰é€²è¡Œå¡«å……ã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">2ï¸âƒ£</span
                  >ç›®æ¨™åºåˆ—ç”Ÿæˆ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  é€šéå°‡è¼¸å…¥åºåˆ—å³ç§»ä¸€ä½ä¾†ç”Ÿæˆç›®æ¨™åºåˆ—ï¼Œé€™æ¨£æ¨¡å‹å¯ä»¥å­¸ç¿’é æ¸¬ä¸‹ä¸€å€‹
                  tokenã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">3ï¸âƒ£</span
                  >å¿½ç•¥ç´¢å¼•è™•ç†
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  å°‡ç›®æ¨™åºåˆ—ä¸­çš„ padding tokens æ¨™è¨˜ç‚º
                  <code>ignore_index</code>ï¼ˆé»˜èªç‚º -100ï¼‰ï¼Œä½¿å®ƒå€‘ä¸åƒèˆ‡ loss
                  è¨ˆç®—ï¼Œä½†ä¿ç•™ç¬¬ä¸€å€‹ padding tokenã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">4ï¸âƒ£</span
                  >é•·åº¦é™åˆ¶
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  å¦‚æœæä¾›äº†
                  <code>allowed_max_length</code>
                  åƒæ•¸ï¼Œå‰‡å°‡è¼¸å…¥å’Œç›®æ¨™åºåˆ—æˆªæ–·åˆ°æŒ‡å®šé•·åº¦ï¼Œä»¥æ§åˆ¶åºåˆ—çš„æœ€å¤§é•·åº¦ã€‚
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #f39c12;
            "
          >
            <h3
              style="
                color: #f39c12;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >çµæœç¯„ä¾‹
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #f39c12;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ”¢</span
                  >è¼¸å…¥å’Œç›®æ¨™å¼µé‡
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  <pre style="margin: 0"><code class="language-python">inputs:
[[ 0,  1,  2,  3,  4],
 [ 5,  6, 50256, 50256, 50256],
 [ 7,  8,  9, 50256, 50256]]

targets:
[[ 1,  2,  3,  4, 50256],
 [ 6, 50256, -100, -100, -100],
 [ 8,  9, 50256, -100, -100]]</code></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 17: Loss Calculation Logic Analysis -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ§ª</span>Loss è¨ˆç®—é‚è¼¯è§£æ</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >Cross Entropy Loss è¨ˆç®—
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              Cross Entropy Loss
              æ˜¯èªè¨€æ¨¡å‹è¨“ç·´ä¸­æœ€å¸¸ç”¨çš„æå¤±å‡½æ•¸ï¼Œç”¨æ–¼è¡¡é‡æ¨¡å‹é æ¸¬èˆ‡å¯¦éš›ç›®æ¨™ä¹‹é–“çš„å·®ç•°ã€‚é€šé
              ignore_index åƒæ•¸ï¼Œæˆ‘å€‘å¯ä»¥æŒ‡å®šæŸäº› token ä¸åƒèˆ‡ loss è¨ˆç®—ã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >Loss è¨ˆç®—ç¤ºä¾‹
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #2ecc71">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">import torch
  
  # æ¨¡æ“¬ logits (é æ¸¬å€¼)
  logits_1 = torch.tensor([
      [-1.0, 1.0],  # ç¬¬ 1 å€‹ token é æ¸¬å€¼
      [-0.5, 1.5]   # ç¬¬ 2 å€‹ token é æ¸¬å€¼
  ])
  targets_1 = torch.tensor([0, 1])
  loss_1 = torch.nn.functional.cross_entropy(logits_1, targets_1)
  print(loss_1)  # tensor(1.1269)
  
  # åŠ å…¥ç¬¬ 3 å€‹ token
  logits_2 = torch.tensor([
      [-1.0, 1.0],
      [-0.5, 1.5],
      [-0.5, 1.5]
  ])
  targets_2 = torch.tensor([0, 1, 1])
  loss_2 = torch.nn.functional.cross_entropy(logits_2, targets_2)
  print(loss_2)  # tensor(0.7936)
  
  # åŠ å…¥ maskingï¼ˆ-100ï¼‰
  targets_3 = torch.tensor([0, 1, -100])
  loss_3 = torch.nn.functional.cross_entropy(logits_2, targets_3, ignore_index=-100)
  print(loss_3)  # tensor(1.1269)ï¼Œå¿½ç•¥äº†ç¬¬ä¸‰å€‹ token çš„ loss</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >Loss è¨ˆç®—é‚è¼¯è§£æ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">1ï¸âƒ£</span
                  >åŸºæœ¬è¨ˆç®—
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  å°æ–¼æ¯å€‹ä½ç½®ï¼Œè¨ˆç®—æ¨¡å‹é æ¸¬çš„ logits èˆ‡ç›®æ¨™ token
                  ä¹‹é–“çš„äº¤å‰ç†µæå¤±ï¼Œç„¶å¾Œå–å¹³å‡å€¼ã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">2ï¸âƒ£</span
                  >å¿½ç•¥ç´¢å¼•çš„ä½œç”¨
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ç•¶ä½¿ç”¨ <code>ignore_index=-100</code> æ™‚ï¼Œæ‰€æœ‰æ¨™è¨˜ç‚º -100
                  çš„ç›®æ¨™ token ä¸åƒèˆ‡ loss
                  è¨ˆç®—ï¼Œé€™ä½¿å¾—æˆ‘å€‘å¯ä»¥é¸æ“‡æ€§åœ°å¿½ç•¥æŸäº›ä½ç½®çš„æå¤±ã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">3ï¸âƒ£</span
                  >ç¤ºä¾‹åˆ†æ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>loss_1</code> å’Œ
                  <code>loss_3</code> çš„å€¼ç›¸åŒï¼ˆ1.1269ï¼‰ï¼Œé€™æ˜¯å› ç‚º
                  <code>loss_3</code> ä¸­çš„ç¬¬ä¸‰å€‹ token è¢«æ¨™è¨˜ç‚º
                  -100ï¼Œä¸åƒèˆ‡è¨ˆç®—ï¼Œæ‰€ä»¥åªè¨ˆç®—äº†å‰å…©å€‹ token çš„æå¤±ï¼Œèˆ‡
                  <code>loss_1</code> ç›¸åŒã€‚
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #9b59b6;
            "
          >
            <h3
              style="
                color: #9b59b6;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“ˆ</span
              >Loss è¨ˆç®—çš„æ‡‰ç”¨
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ¯</span
                  >åœ¨æŒ‡ä»¤å¾®èª¿ä¸­çš„æ‡‰ç”¨
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åœ¨æŒ‡ä»¤å¾®èª¿ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ ignore_index ä¾†é¸æ“‡æ€§åœ°å¿½ç•¥
                  instruction å’Œ input éƒ¨åˆ†çš„æå¤±ï¼Œåªè®“æ¨¡å‹å­¸ç¿’ç”Ÿæˆ response
                  éƒ¨åˆ†ã€‚é€™æ¨£å¯ä»¥é¿å…æ¨¡å‹èƒŒèª¦
                  promptï¼Œå°ˆæ³¨æ–¼å­¸ç¿’å¦‚ä½•æ ¹æ“šæŒ‡ä»¤ç”Ÿæˆå›æ‡‰ã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ”„</span
                  >èˆ‡ padding è™•ç†çš„çµåˆ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  åœ¨æ‰¹è™•ç†ä¸­ï¼Œæˆ‘å€‘é€šå¸¸æœƒå°‡ä¸åŒé•·åº¦çš„åºåˆ—å¡«å……åˆ°ç›¸åŒé•·åº¦ï¼Œä¸¦å°‡å¡«å……éƒ¨åˆ†çš„ç›®æ¨™
                  token æ¨™è¨˜ç‚º -100ï¼Œä½¿å®ƒå€‘ä¸åƒèˆ‡ loss
                  è¨ˆç®—ã€‚é€™æ¨£å¯ä»¥ç¢ºä¿æ¨¡å‹åªå­¸ç¿’é æ¸¬å¯¦éš›çš„å…§å®¹ï¼Œè€Œä¸æ˜¯å¡«å…… tokenã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 18: Instruction Masking -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ­</span>Instruction Masking</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >é®ç½©çš„æ¦‚å¿µ
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              é™¤äº† padding tokenï¼Œä¹Ÿå¯é¸æ“‡æ€§åœ° mask æ‰ instruction/input çš„
              tokensï¼Œé¿å…æ¨¡å‹èƒŒèª¦ promptã€‚å°‡è©²å€æ®µ token ID è¨­ç‚º -100ï¼Œè®“ loss
              åªå° response å€æ®µè² è²¬ã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">âš ï¸</span
              >æœ€æ–°ç ”ç©¶ç™¼ç¾
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <p style="margin: 0; font-size: 1.1rem">
                2024 å¹´çš„è«–æ–‡ã€ŠInstruction Tuning With Loss Over
                Instructionsã€‹æŒ‡å‡ºï¼š<strong
                  >ä¸é®è”½ instruction èƒ½å¸¶ä¾†æ›´å¥½çš„æ•ˆæœ</strong
                >ã€‚æœ¬æ›¸è®“ä½ è¦–æƒ…æ³æ±ºå®šæ˜¯å¦æ¡ç”¨é®ç½©ç­–ç•¥ã€‚
              </p>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >æ•´åˆé®ç½©çš„ Collate Function
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #e74c3c">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">def custom_collate_fn(
    batch,
    pad_token_id=50256,
    ignore_index=-100,
    allowed_max_length=None,
    device="cpu"
):
    batch_max_length = max(len(item) + 1 for item in batch)
    inputs_list, targets_list = [], []

    for item in batch:
        new_item = item.copy()
        new_item += [pad_token_id]  # append one for target shift
        padded = new_item + [pad_token_id] * (batch_max_length - len(new_item))

        inputs = torch.tensor(padded[:-1])
        targets = torch.tensor(padded[1:])

        # é®è”½ padding tokenï¼ˆé™¤äº†ç¬¬ä¸€å€‹ï¼‰
        mask = targets == pad_token_id
        indices = torch.nonzero(mask).squeeze()
        if indices.numel() > 1:
            targets[indices[1:]] = ignore_index

        # é®è”½ instruction å€æ®µï¼ˆoptionalï¼Œè¦‹ Figure 7.13ï¼‰
        # å¯è‡ªè¡Œè¨­è¨ˆé¡å¤– masking æ©Ÿåˆ¶ï¼Œæ‰¾å‡º instruction å°æ‡‰çš„ä½ç½®å¾Œè¨­æˆ -100

        if allowed_max_length is not None:
            inputs = inputs[:allowed_max_length]
            targets = targets[:allowed_max_length]

        inputs_list.append(inputs)
        targets_list.append(targets)

    return (
        torch.stack(inputs_list).to(device),
        torch.stack(targets_list).to(device)
    )</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #9b59b6;
            "
          >
            <h3
              style="
                color: #9b59b6;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >é®ç½©ç¯„ä¾‹
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <img src="images/fig7_13.png" alt="Figure 7.13" />
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <table style="width: 100%; border-collapse: collapse">
                  <thead>
                    <tr style="background-color: #9b59b6; color: white">
                      <th
                        style="
                          padding: 0.8rem;
                          text-align: left;
                          border-radius: 4px 0 0 0;
                        "
                      >
                        å€æ®µ
                      </th>
                      <th
                        style="
                          padding: 0.8rem;
                          text-align: left;
                          border-radius: 0 4px 0 0;
                        "
                      >
                        æ˜¯å¦åƒèˆ‡ loss
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr style="background-color: #f8f9fa">
                      <td
                        style="padding: 0.8rem; border-bottom: 1px solid #ddd"
                      >
                        Instruction
                      </td>
                      <td
                        style="padding: 0.8rem; border-bottom: 1px solid #ddd"
                      >
                        âŒ -100
                      </td>
                    </tr>
                    <tr style="background-color: white">
                      <td
                        style="padding: 0.8rem; border-bottom: 1px solid #ddd"
                      >
                        Input
                      </td>
                      <td
                        style="padding: 0.8rem; border-bottom: 1px solid #ddd"
                      >
                        âŒ -100
                      </td>
                    </tr>
                    <tr style="background-color: #f8f9fa">
                      <td style="padding: 0.8rem">Response</td>
                      <td style="padding: 0.8rem">âœ… æ­£å¸¸è¨ˆç®—</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #f39c12;
            "
          >
            <h3
              style="
                color: #f39c12;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">âœ…</span
              >å»ºè­°åšæ³•
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <table style="width: 100%; border-collapse: collapse">
                  <thead>
                    <tr style="background-color: #f39c12; color: white">
                      <th
                        style="
                          padding: 0.8rem;
                          text-align: left;
                          border-radius: 4px 0 0 0;
                        "
                      >
                        å ´æ™¯
                      </th>
                      <th
                        style="
                          padding: 0.8rem;
                          text-align: left;
                          border-radius: 0 4px 0 0;
                        "
                      >
                        å»ºè­°åšæ³•
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr style="background-color: #f8f9fa">
                      <td
                        style="padding: 0.8rem; border-bottom: 1px solid #ddd"
                      >
                        é è¨­æƒ…æ³ / å°æ¨¡å‹ / è³‡æ–™å°‘
                      </td>
                      <td
                        style="padding: 0.8rem; border-bottom: 1px solid #ddd"
                      >
                        ä¸é®è”½ instruction
                      </td>
                    </tr>
                    <tr style="background-color: white">
                      <td style="padding: 0.8rem">
                        é¿å… overfitting / response ç²¾æº–è¨“ç·´
                      </td>
                      <td style="padding: 0.8rem">æ¡ç”¨ masking</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 19: Creating Data Loaders for an Instruction Dataset-->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”Œ</span>å»ºç«‹ DataLoader ä»¥ä¾› LLM å¾®èª¿ä½¿ç”¨</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ¯</span
              >ç›®æ¨™
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              æ•´åˆè‡ªè¨‚çš„ <code>InstructionDataset</code> é¡åˆ¥ï¼ˆç”¨ä¾†æ ¼å¼åŒ–å’Œç·¨ç¢¼
              instructionï¼‰å’Œè‡ªè¨‚çš„ <code>custom_collate_fn</code>ï¼ˆè™•ç†
              paddingã€target shiftingã€maskingï¼‰ä¾†å»ºç«‹è¨“ç·´ã€é©—è­‰ã€æ¸¬è©¦çš„
              PyTorch <code>DataLoader</code>ã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >è£ç½®è¨­å®š
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #2ecc71">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
print("Device:", device)

# è‹¥ä½¿ç”¨ Apple M1/M2 æ™¶ç‰‡ï¼Œå¯é¸æ“‡ï¼š
# device = torch.device("mps")</code></pre>
              </div>
              <p style="margin: 1rem 0 0 0; font-size: 1.1rem">
                ç‚ºäº†é¿å…åœ¨è¨“ç·´ loop é˜»å¡ GPU è¨ˆç®—ï¼Œå¯åœ¨
                <code>collate_fn</code> è£¡è¨­å®šè³‡æ–™æ¬ç§»è‡³ GPUï¼ˆæˆ– CPUï¼‰ã€‚
              </p>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ› </span>ä½¿ç”¨
              functools.partial è£½ä½œ collate function
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #e74c3c">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">from functools import partial

customized_collate_fn = partial(
    custom_collate_fn,           # ä¹‹å‰å®šç¾©çš„ collate å‡½æ•¸
    device=device,
    allowed_max_length=1024      # é™åˆ¶åºåˆ—é•·åº¦
)</code></pre>
              </div>
              <p style="margin: 1rem 0 0 0; font-size: 1.1rem">
                è¨­å®šå¥½è£ç½®èˆ‡æœ€å¤§é•·åº¦å¾Œï¼Œä½¿ç”¨
                <code>partial()</code> è‡ªå‹•å‚³å…¥é€™äº›é è¨­åƒæ•¸ã€‚
              </p>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #9b59b6;
            "
          >
            <h3
              style="
                color: #9b59b6;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ§±</span
              >åˆå§‹åŒ– DataLoader
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #9b59b6">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">from torch.utils.data import DataLoader

num_workers = 0          # å¯ä¾ä½œæ¥­ç³»çµ±èª¿é«˜
batch_size = 8

torch.manual_seed(123)   # è¨­å®šéš¨æ©Ÿç¨®å­ç¢ºä¿å¯é‡ç¾æ€§

# å‡è¨­å·²ç¶“æœ‰ train_data, val_data, test_data
train_dataset = InstructionDataset(train_data, tokenizer)
val_dataset   = InstructionDataset(val_data, tokenizer)
test_dataset  = InstructionDataset(test_data, tokenizer)

train_loader = DataLoader(
    train_dataset,
    batch_size=batch_size,
    collate_fn=customized_collate_fn,
    shuffle=True,
    drop_last=True,
    num_workers=num_workers
)

val_loader = DataLoader(
    val_dataset,
    batch_size=batch_size,
    collate_fn=customized_collate_fn,
    shuffle=False,
    drop_last=False,
    num_workers=num_workers
)

test_loader = DataLoader(
    test_dataset,
    batch_size=batch_size,
    collate_fn=customized_collate_fn,
    shuffle=False,
    drop_last=False,
    num_workers=num_workers
)</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #f39c12;
            "
          >
            <h3
              style="
                color: #f39c12;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >è¼¸å‡ºæª¢æŸ¥çµæœ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #f39c12;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“Š</span
                  >æª¢æŸ¥ input èˆ‡ target å¼µé‡çš„ shape
                </h4>
                <div
                  style="display: flex; align-items: flex-start; gap: 0.5rem"
                >
                  <span style="font-size: 1.2rem; color: #f39c12">ğŸ“Œ</span>
                  <pre
                    style="
                      margin: 0;
                      background-color: #282c34;
                      border-radius: 6px;
                      padding: 0.8rem;
                    "
                  ><code class="language-python">print("Train loader:")
for inputs, targets in train_loader:
    print(inputs.shape, targets.shape)</code></pre>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #f39c12;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“</span
                  >è¼¸å‡ºç¯„ä¾‹
                </h4>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                    color: #f8f9fa;
                  "
                ><code>torch.Size([8, 61]) torch.Size([8, 61])
torch.Size([8, 76]) torch.Size([8, 76])
torch.Size([8, 73]) torch.Size([8, 73])
...</code></pre>
                <p style="margin: 1rem 0 0 0; font-size: 1.1rem">
                  - <strong>8</strong>ï¼šè¡¨ç¤º batch size<br />
                  - <strong>61 / 76 / 73</strong>ï¼šè¡¨ç¤ºé€™å€‹ batch
                  ä¸­ï¼Œæ¯ç­†è³‡æ–™ç¶“é padding å¾Œçš„ token æ•¸é‡
                </p>
                <p
                  style="
                    margin: 0.5rem 0 0 0;
                    font-size: 1.1rem;
                    font-style: italic;
                  "
                >
                  > ğŸ” è¬è¬æˆ‘å€‘çš„ custom collate functionï¼Œä¸åŒ batch
                  å¯å…·æœ‰ä¸åŒé•·åº¦ï¼
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #1abc9c;
            "
          >
            <h3
              style="
                color: #1abc9c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”„</span
              >ä¸‰éšæ®µå›é¡§
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; flex-direction: column; gap: 0.8rem">
                  <div style="display: flex; align-items: center; gap: 0.5rem">
                    <span style="font-size: 1.2rem; color: #1abc9c">1ï¸âƒ£</span>
                    <span style="font-size: 1.1rem"
                      >Dataset formatting
                      <span style="color: #1abc9c">âœ”ï¸</span></span
                    >
                  </div>
                  <div style="display: flex; align-items: center; gap: 0.5rem">
                    <span style="font-size: 1.2rem; color: #1abc9c">2ï¸âƒ£</span>
                    <span style="font-size: 1.1rem"
                      >Batching with padding/masking
                      <span style="color: #1abc9c">âœ”ï¸</span></span
                    >
                  </div>
                  <div style="display: flex; align-items: center; gap: 0.5rem">
                    <span style="font-size: 1.2rem; color: #1abc9c">3ï¸âƒ£</span>
                    <span style="font-size: 1.1rem"
                      >DataLoader å»ºç«‹
                      <span style="color: #1abc9c">âœ”ï¸</span></span
                    >
                  </div>
                </div>
                <p
                  style="
                    margin: 1rem 0 0 0;
                    font-size: 1.1rem;
                    font-style: italic;
                  "
                >
                  > ä¸‹ä¸€æ­¥æ˜¯è¼‰å…¥ LLM ä¸¦ä½¿ç”¨é€™äº› batches å¾®èª¿æ¨¡å‹ã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 20: Model Inference Before Fine-tuning -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ§ª</span>æ¨¡å‹å¾®èª¿å‰è©•ä¼°</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“</span
              >è©•ä¼°ç›®çš„
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              åœ¨é€²è¡ŒæŒ‡ä»¤å¾®èª¿å‰ï¼Œå…ˆè©•ä¼°é è¨“ç·´æ¨¡å‹çš„åŸå§‹è¡¨ç¾ï¼Œä»¥ä¾¿èˆ‡å¾®èª¿å¾Œçš„çµæœé€²è¡Œæ¯”è¼ƒï¼Œäº†è§£å¾®èª¿çš„æ•ˆæœã€‚
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >è¼¸å…¥æ¸¬è©¦è³‡æ–™
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #2ecc71">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">torch.manual_seed(123)
input_text = format_input(val_data[0])
print(input_text)</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“¥</span
              >æ¸¬è©¦å…§å®¹
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #e74c3c">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-text">Convert the active sentence to passive: 'The chef cooks the meal every day.'</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #9b59b6;
            "
          >
            <h3
              style="
                color: #9b59b6;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >é æœŸçµæœ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">âœ…</span
                  >æ­£ç¢ºç­”æ¡ˆ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  The meal is cooked by the chef every day.
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #9b59b6;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">â“</span
                  >é è¨“ç·´æ¨¡å‹å¯èƒ½çš„å›æ‡‰
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  é è¨“ç·´æ¨¡å‹å¯èƒ½ç„¡æ³•æ­£ç¢ºç†è§£æŒ‡ä»¤ï¼Œæˆ–ç”Ÿæˆèˆ‡æŒ‡ä»¤ç„¡é—œçš„å…§å®¹ï¼Œé€™æ­£æ˜¯æˆ‘å€‘éœ€è¦é€²è¡ŒæŒ‡ä»¤å¾®èª¿çš„åŸå› ã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 21: Generating Response and Results Observation -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸš€</span>æ¨¡å‹å›æ‡‰ç”Ÿæˆèˆ‡çµæœè§€å¯Ÿ</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >ç”Ÿæˆå›æ‡‰ä»£ç¢¼
            </h3>
            <div
              style="
                background-color: white;
                padding: 1rem;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                margin-top: 1rem;
              "
            >
              <div style="display: flex; align-items: flex-start; gap: 0.5rem">
                <span style="font-size: 1.2rem; color: #3498db">ğŸ“Œ</span>
                <pre
                  style="
                    margin: 0;
                    background-color: #282c34;
                    border-radius: 6px;
                    padding: 0.8rem;
                  "
                ><code class="language-python">from chapter05 import generate, text_to_token_ids, token_ids_to_text

token_ids = generate(
    model=model,
    idx=text_to_token_ids(input_text, tokenizer),
    max_new_tokens=35,
    context_size=BASE_CONFIG["context_length"],
    eos_id=50256,
)

generated_text = token_ids_to_text(token_ids, tokenizer)

# å»é™¤é–‹é ­çš„ input promptï¼Œä¿ç•™ response éƒ¨åˆ†
response_text = generated_text[len(input_text):].strip()
print(response_text)</code></pre>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >çµæœè§€å¯Ÿ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ”</span
                  >é è¨“ç·´æ¨¡å‹å›æ‡‰
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  "The chef cooks the meal every day. The chef is cooking the
                  meal. The chef has cooked the meal. The chef will cook the
                  meal. The chef is going to cook the meal."
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">âœ…</span
                  >æ­£ç¢ºç­”æ¡ˆ
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  "The meal is cooked by the chef every day."
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #2ecc71;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">âŒ</span
                  >åˆ†æ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  é è¨“ç·´æ¨¡å‹ç„¡æ³•ç†è§£ã€ŒConvert the active sentence to
                  passiveã€çš„æŒ‡ä»¤ï¼Œåªæ˜¯é‡è¤‡äº†è¼¸å…¥çš„å¥å­ï¼Œä¸¦ç”Ÿæˆäº†ä¸€äº›ç›¸é—œä½†ä¸ç¬¦åˆæŒ‡ä»¤çš„å¥å­ã€‚é€™è¡¨æ˜æ¨¡å‹éœ€è¦é€²è¡ŒæŒ‡ä»¤å¾®èª¿ï¼Œä»¥å­¸ç¿’å¦‚ä½•éµå¾ªç‰¹å®šæŒ‡ä»¤ã€‚
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”®</span
              >å¾®èª¿å¾Œé æœŸçµæœ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">âœ¨</span
                  >é æœŸå›æ‡‰
                </h4>
                <div
                  style="
                    background-color: #f1f1f1;
                    padding: 0.8rem;
                    border-radius: 4px;
                    font-family: monospace;
                    font-size: 1rem;
                  "
                >
                  "The meal is cooked by the chef every day."
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“ˆ</span
                  >å¾®èª¿æ•ˆæœ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  é€šéæŒ‡ä»¤å¾®èª¿ï¼Œæ¨¡å‹å°‡å­¸æœƒç†è§£ä¸¦åŸ·è¡Œã€ŒConvert the active
                  sentence to
                  passiveã€ç­‰æŒ‡ä»¤ï¼Œèƒ½å¤ æ­£ç¢ºåœ°å°‡ä¸»å‹•èªæ…‹è½‰æ›ç‚ºè¢«å‹•èªæ…‹ï¼Œè€Œä¸æ˜¯ç°¡å–®åœ°é‡è¤‡è¼¸å…¥æˆ–ç”Ÿæˆç„¡é—œå…§å®¹ã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 22: Fine-tuning the LLM on Instruction Data -->
    <div class="slide">
      <div class="slide-content">
        <h2>
          <span class="emoji">ğŸ“˜</span>7.6 é‡é»æ•´ç†ï¼šå° LLM é€²è¡ŒæŒ‡ä»¤è³‡æ–™å¾®èª¿
        </h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ¯</span
              >å¾®èª¿æµç¨‹ç›®æ¨™
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              é€™ä¸€æ­¥é©Ÿæ­£å¼é€²å…¥å¾®èª¿éšæ®µï¼Œä½¿ç”¨å‰é¢æº–å‚™å¥½çš„ï¼š
            </p>
            <ul style="font-size: 1.1rem; line-height: 1.5">
              <li>Instruction datasetï¼ˆè¨“ç·´è³‡æ–™ï¼‰</li>
              <li>Customized DataLoader</li>
              <li>é è¨“ç·´æ¨¡å‹ï¼ˆGPT-2 Mediumï¼‰</li>
            </ul>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“‹</span
              >å¾®èª¿æµç¨‹æ­¥é©Ÿ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">1ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">è¨ˆç®—åˆå§‹è¨“ç·´ / é©—è­‰æå¤±</span>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">2ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">è¨­å®šå„ªåŒ–å™¨èˆ‡å­¸ç¿’ç‡</span>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">3ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">åŸ·è¡Œè¨“ç·´å¾ªç’°</span>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">4ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">å®šæœŸè©•ä¼°æ¨¡å‹æ€§èƒ½</span>
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">5ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">ä¿å­˜æœ€ä½³æ¨¡å‹</span>
                </div>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >å¾®èª¿æ•ˆæœè©•ä¼°
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“ˆ</span
                  >æå¤±å‡½æ•¸è®ŠåŒ–
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  è§€å¯Ÿè¨“ç·´å’Œé©—è­‰æå¤±çš„è®ŠåŒ–è¶¨å‹¢ï¼Œç¢ºä¿æ¨¡å‹æ­£åœ¨å­¸ç¿’è€Œä¸æ˜¯éæ“¬åˆã€‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ¯</span
                  >æŒ‡ä»¤éµå¾ªèƒ½åŠ›
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  é€šéæŒ‡ä»¤å¾®èª¿ï¼Œæ¨¡å‹å°‡å­¸æœƒç†è§£ä¸¦åŸ·è¡Œã€ŒConvert the active
                  sentence to
                  passiveã€ç­‰æŒ‡ä»¤ï¼Œèƒ½å¤ æ­£ç¢ºåœ°å°‡ä¸»å‹•èªæ…‹è½‰æ›ç‚ºè¢«å‹•èªæ…‹ï¼Œè€Œä¸æ˜¯ç°¡å–®åœ°é‡è¤‡è¼¸å…¥æˆ–ç”Ÿæˆç„¡é—œå…§å®¹ã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 23: Hardware Recommendations -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ§ </span>è£œå……ï¼šç¡¬é«”å»ºè­°</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’»</span
              >ç¡¬é«”æ•ˆèƒ½æ¯”è¼ƒ
            </h3>
            <div style="margin-top: 1rem; text-align: center">
              <img
                src="images/fig7_16.PNG"
                alt="hardware recommendation"
                style="
                  max-width: 100%;
                  border-radius: 8px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                "
              />
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”§</span
              >è³‡æºæœ‰é™æ™‚çš„å„ªåŒ–æ–¹æ¡ˆ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">1ï¸âƒ£</span>
                  <span style="font-size: 1.1rem"
                    >ä½¿ç”¨ <code>gpt2-small</code> æ¨¡å‹</span
                  >
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  æ¨¡å‹åƒæ•¸é‡å¾ 355M é™è‡³ 124Mï¼Œå¤§å¹…æ¸›å°‘è¨˜æ†¶é«”éœ€æ±‚
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">2ï¸âƒ£</span>
                  <span style="font-size: 1.1rem"
                    >èª¿æ•´æ‰¹æ¬¡å¤§å° <code>batch_size</code></span
                  >
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  æ¸›å°‘æ¯æ‰¹æ¬¡è™•ç†çš„æ¨£æœ¬æ•¸é‡ï¼Œé™ä½ GPU è¨˜æ†¶é«”ä½¿ç”¨
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #2ecc71">3ï¸âƒ£</span>
                  <span style="font-size: 1.1rem"
                    >é™åˆ¶åºåˆ—é•·åº¦ <code>allowed_max_length</code></span
                  >
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  ç¸®çŸ­è¼¸å…¥åºåˆ—çš„æœ€å¤§é•·åº¦ï¼Œé€²ä¸€æ­¥æ¸›å°‘è¨ˆç®—è³‡æºéœ€æ±‚
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">âš¡</span
              >æ•ˆèƒ½æå‡æ•ˆæœ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸš€</span
                  >GPU åŠ é€Ÿ
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ä½¿ç”¨ NVIDIA A100 GPU å¯å°‡è¨“ç·´æ™‚é–“å¾ 15.78 åˆ†é˜ç¸®çŸ­è‡³ 1.83
                  åˆ†é˜ï¼Œæå‡ç´„ 8.6 å€æ•ˆèƒ½
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“‰</span
                  >æ¨¡å‹ç¸®å°
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ä½¿ç”¨ gpt2-small æ¨¡å‹åœ¨ A100 GPU ä¸Šåƒ…éœ€ 0.39 åˆ†é˜ï¼Œæ¯”
                  gpt2-medium å¿«ç´„ 4.7 å€
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 24: Initial Loss Calculation -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">âœ…</span>åˆå§‹æå¤±è¨ˆç®—</h2>
        <p>ä½¿ç”¨ç¬¬ 5 ç« çš„å·¥å…·å‡½æ•¸ï¼š</p>
        <pre><code class="language-python">from chapter05 import calc_loss_loader, train_model_simple

model.to(device)
torch.manual_seed(123)

with torch.no_grad():
    train_loss = calc_loss_loader(train_loader, model, device, num_batches=5)
    val_loss = calc_loss_loader(val_loader, model, device, num_batches=5)

print("Training loss:", train_loss)
print("Validation loss:", val_loss)</code></pre>

        <h3>ğŸ“¥ ç¯„ä¾‹è¼¸å‡ºï¼š</h3>
        <pre><code class="language-text">Training loss: 3.825...
Validation loss: 3.761...</code></pre>
      </div>
    </div>

    <!-- Slide 25: Fine-tuning Training -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">âœ…</span>åŸ·è¡Œå¾®èª¿è¨“ç·´</h2>
        <pre><code class="language-python">import time

start_time = time.time()
torch.manual_seed(123)

optimizer = torch.optim.AdamW(
    model.parameters(), lr=0.00005, weight_decay=0.1
)

num_epochs = 2

train_losses, val_losses, token_seen = train_model_simple(
    model, train_loader, val_loader, optimizer, device,
    num_epochs=num_epochs, eval_freq=5, eval_iters=5,
    start_context=format_input(val_data[0]),
    tokenizer=tokenizer
)

end_time = time.time()
print(f"Training completed in {(end_time - start_time) / 60:.2f} minutes.")</code></pre>
      </div>
    </div>

    <!-- Slide 26: Training Output Observation and Loss Curves -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ“Š</span>è¨“ç·´è¼¸å‡ºè§€å¯Ÿèˆ‡æå¤±æ›²ç·šåˆ†æ</h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“ˆ</span
              >è¨“ç·´éç¨‹è¼¸å‡º
            </h3>
            <pre><code class="language-text">Ep 1 (Step 000015): Train loss 2.637, Val loss 2.626
Ep 1 (Step 000050): Train loss 1.174, Val loss 1.104
...
Ep 2 (Step 000150): Train loss 0.300, Val loss 0.657</code></pre>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">âœ…</span
              >æ¨¡å‹ç”¢ç”Ÿçš„å›ç­”
            </h3>
            <pre><code class="language-markdown">### Instruction:
Convert the active sentence to passive:
'The chef cooks the meal every day.'

### Response:
The meal is cooked every day by the chef.</code></pre>
            <p style="margin-top: 1rem; font-size: 1.1rem; color: #2ecc71">
              âœ… é¡¯ç¤ºæ¨¡å‹å·²å­¸æœƒå¦‚ä½•è™•ç†ã€Œä¸»å‹•è½‰è¢«å‹•ã€çš„ä»»å‹™ï¼
            </p>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“‰</span
              >æå¤±æ›²ç·šåˆ†æ
            </h3>
            <pre><code class="language-python">from chapter05 import plot_losses

epochs_tensor = torch.linspace(0, num_epochs, len(train_losses))
plot_losses(epochs_tensor, token_seen, train_losses, val_losses)</code></pre>

            <div style="margin-top: 1rem; text-align: center">
              <img
                src="images/fig7_17.PNG"
                alt="loss curve"
                style="
                  max-width: 100%;
                  border-radius: 8px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                "
              />
            </div>

            <h4
              style="
                color: #e74c3c;
                margin: 1rem 0 0.5rem 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ“Š</span
              >åœ–è§£çµæœåˆ†æ
            </h4>
            <ul style="font-size: 1.1rem; line-height: 1.5; margin: 0">
              <li>è¨“ç·´æå¤±ï¼ˆè—ç·šï¼‰å’Œé©—è­‰æå¤±ï¼ˆç´…ç·šï¼‰éƒ½å‘ˆç¾ä¸‹é™è¶¨å‹¢</li>
              <li>æ¨¡å‹åœ¨è¨“ç·´éç¨‹ä¸­å­¸ç¿’æ•ˆæœè‰¯å¥½ï¼Œæ²’æœ‰æ˜é¡¯éæ“¬åˆç¾è±¡</li>
              <li>æå¤±å€¼å¾åˆå§‹çš„2.6é™è‡³0.3å·¦å³ï¼Œè¡¨æ˜æ¨¡å‹æˆåŠŸå­¸ç¿’äº†æŒ‡ä»¤ä»»å‹™</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 27: Extracting and Saving Responses -->
    <div class="slide">
      <div class="slide-content">
        <h2>
          <span class="emoji">ğŸ§ </span>7.7
          é‡é»æ•´ç†ï¼šå¾å¾®èª¿å¾Œçš„æ¨¡å‹ç”¢å‡ºå›æ‡‰ï¼Œä¸¦å„²å­˜é€²è¡Œè©•ä¼°
        </h2>

        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1.5rem;
          "
        >
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“‹</span
              >è©•ä¼°éšæ®µæ¦‚è¿°
            </h3>
            <p style="font-size: 1.1rem; line-height: 1.5">
              é€™ä¸€æ­¥æ˜¯
              <strong style="color: #3498db"
                >Stage 3: Evaluating the LLM</strong
              >
              çš„ç¬¬ä¸€å€‹æ­¥é©Ÿï¼Œæ ¸å¿ƒç›®æ¨™æ˜¯ï¼š
            </p>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 0.8rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">1ï¸âƒ£</span>
                  <span style="font-size: 1.1rem"
                    >ä½¿ç”¨å¾®èª¿å¾Œçš„æ¨¡å‹å° test set æ¯å€‹æŒ‡ä»¤ç”¢ç”Ÿå›æ‡‰</span
                  >
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">2ï¸âƒ£</span>
                  <span style="font-size: 1.1rem"
                    >å„²å­˜é€™äº›å›æ‡‰è‡³ JSON ä»¥ä¾¿å¾ŒçºŒè©•ä¼°ï¼ˆäººå·¥æˆ–è‡ªå‹•ï¼‰</span
                  >
                </div>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">3ï¸âƒ£</span>
                  <span style="font-size: 1.1rem"
                    >åŸ·è¡Œ side-by-side å°æ¯”è§€å¯Ÿæ¨¡å‹è¡¨ç¾</span
                  >
                </div>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #2ecc71;
            "
          >
            <h3
              style="
                color: #2ecc71;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ’¾</span
              >å›æ‡‰å„²å­˜æ ¼å¼
            </h3>
            <div style="margin-top: 1rem">
              <pre><code class="language-json">{
  "instruction": "Convert the active sentence to passive: 'The chef cooks the meal every day.'",
  "input": "",
  "output": "The meal is cooked every day by the chef.",
  "model_response": "The meal is cooked every day by the chef."
}</code></pre>
              <p style="margin-top: 1rem; font-size: 1.1rem; color: #2ecc71">
                âœ… æ¨™æº–åŒ–æ ¼å¼ä¾¿æ–¼å¾ŒçºŒåˆ†æå’Œæ¯”è¼ƒ
              </p>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ”</span
              >è©•ä¼°æ–¹æ³•
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ‘¤</span
                  >äººå·¥è©•ä¼°
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ç”±äººé¡è©•å¯©å“¡æ ¹æ“šé è¨­æ¨™æº–å°æ¨¡å‹å›æ‡‰é€²è¡Œè©•åˆ†ï¼Œè©•ä¼°å…¶æ­£ç¢ºæ€§ã€ç›¸é—œæ€§å’Œèªè¨€è³ªé‡
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <h4
                  style="
                    color: #e74c3c;
                    margin: 0 0 0.5rem 0;
                    display: flex;
                    align-items: center;
                  "
                >
                  <span style="font-size: 1.2rem; margin-right: 0.5rem">ğŸ¤–</span
                  >è‡ªå‹•è©•ä¼°
                </h4>
                <p style="margin: 0; font-size: 1.1rem">
                  ä½¿ç”¨é å®šç¾©çš„è©•ä¼°æŒ‡æ¨™ï¼ˆå¦‚ BLEUã€ROUGEã€BERTScore
                  ç­‰ï¼‰è‡ªå‹•è¨ˆç®—æ¨¡å‹å›æ‡‰èˆ‡åƒè€ƒç­”æ¡ˆçš„ç›¸ä¼¼åº¦
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Slide 28: Evaluation Process -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">âœ…</span>è©•ä¼°æ¨¡å‹å›æ‡‰å“è³ª</h2>
        <p>ä½¿ç”¨ prompt è«‹ LLaMA å›å‚³ã€Œ0â€“100 åˆ†æ•¸ã€ï¼š</p>
        <pre><code class="language-python">def generate_model_scores(json_data, json_key="model_response", model="llama3"):
    scores = []
    for entry in tqdm(json_data, desc="Scoring entries"):
        prompt = (
            f"Given the input `{format_input(entry)}` "
            f"and correct output `{entry['output']}`, "
            f"score the model response `{entry[json_key]}` "
            f"on a scale from 0 to 100, where 100 is the best score. "
            f"Respond with the integer number only."
        )
        score = query_model(prompt, model)
        try:
            scores.append(int(score))
        except ValueError:
            print(f"Could not convert score: {score}")
            continue
    return scores</code></pre>
      </div>
    </div>

    <!-- Slide 29: Execute and Calculate Average Score -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ§ª</span>å¯¦éš›åŸ·è¡Œèˆ‡å¹³å‡åˆ†è¨ˆç®—</h2>
        <pre><code class="language-python">scores = generate_model_scores(test_data, "model_response")

print(f"Number of scores: {len(scores)} / {len(test_data)}")
print(f"Average score: {sum(scores)/len(scores):.2f}")</code></pre>

        <h3>ğŸ“¥ ç¯„ä¾‹è¼¸å‡ºï¼š</h3>
        <pre><code class="language-text">Number of scores: 110 / 110
Average score: 50.32</code></pre>
      </div>
    </div>

    <!-- Slide 30: Improvement Suggestions -->
    <div class="slide">
      <div class="slide-content">
        <h2><span class="emoji">ğŸ”</span>æ”¹é€²å»ºè­°</h2>

        <div style="display: flex; gap: 1.5rem; margin-top: 1.5rem">
          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #3498db;
            "
          >
            <h3
              style="
                color: #3498db;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“ˆ</span
              >æ¨¡å‹è¡¨ç¾æå‡æ–¹æ¡ˆ
            </h3>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 0.8rem;
                margin-top: 1rem;
              "
            >
              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">1ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">èª¿æ•´è¨“ç·´åƒæ•¸</span>
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  å¢åŠ  epochs / batch size / learning rate ä»¥å„ªåŒ–è¨“ç·´éç¨‹
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">2ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">æ“´å¢è¨“ç·´è³‡æ–™</span>
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  ä½¿ç”¨æ›´è±å¯Œçš„è³‡æ–™é›†ï¼ˆå¦‚ Alpacaï¼‰æå‡æ¨¡å‹å­¸ç¿’æ•ˆæœ
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">3ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹</span>
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  å˜—è©¦ LLaMA 13Bã€GPT-4 ç­‰æ›´å¤§è¦æ¨¡çš„æ¨¡å‹
                </p>
              </div>

              <div
                style="
                  background-color: white;
                  padding: 1rem;
                  border-radius: 6px;
                  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                "
              >
                <div style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="font-size: 1.2rem; color: #3498db">4ï¸âƒ£</span>
                  <span style="font-size: 1.1rem">å„ªåŒ–æç¤ºè©è¨­è¨ˆ</span>
                </div>
                <p style="margin: 0.5rem 0 0 0; font-size: 1rem; color: #666">
                  æ”¹è®Š prompt é¢¨æ ¼ä»¥æå‡è¨“ç·´æ•ˆæœå’Œæ¨¡å‹å›æ‡‰å“è³ª
                </p>
              </div>
            </div>
          </div>

          <div
            style="
              background-color: #f8f9fa;
              padding: 1.5rem;
              border-radius: 8px;
              border-left: 4px solid #e74c3c;
            "
          >
            <h3
              style="
                color: #e74c3c;
                margin-top: 0;
                display: flex;
                align-items: center;
              "
            >
              <span style="font-size: 1.5rem; margin-right: 0.5rem">ğŸ“Š</span
              >æ¨¡å‹æ•ˆèƒ½æ¯”è¼ƒ
            </h3>
            <div style="margin-top: 1rem; overflow-x: auto">
              <table
                style="
                  width: 100%;
                  border-collapse: collapse;
                  font-size: 1.1rem;
                "
              >
                <thead>
                  <tr style="background-color: #f1f1f1">
                    <th
                      style="
                        padding: 0.75rem;
                        text-align: left;
                        border-bottom: 2px solid #e74c3c;
                      "
                    >
                      æ¨¡å‹
                    </th>
                    <th
                      style="
                        padding: 0.75rem;
                        text-align: center;
                        border-bottom: 2px solid #e74c3c;
                      "
                    >
                      åˆ†æ•¸
                    </th>
                    <th
                      style="
                        padding: 0.75rem;
                        text-align: center;
                        border-bottom: 2px solid #e74c3c;
                      "
                    >
                      ç‹€æ…‹
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr style="border-bottom: 1px solid #eee">
                    <td style="padding: 0.75rem">æˆ‘å€‘è¨“ç·´çš„ gpt2-medium-sft</td>
                    <td
                      style="
                        padding: 0.75rem;
                        text-align: center;
                        font-weight: bold;
                      "
                    >
                      50.32
                    </td>
                    <td style="padding: 0.75rem; text-align: center">
                      åŸºç¤ç‰ˆæœ¬
                    </td>
                  </tr>
                  <tr style="border-bottom: 1px solid #eee">
                    <td style="padding: 0.75rem">llama3-8B (ç„¡å¾®èª¿)</td>
                    <td
                      style="
                        padding: 0.75rem;
                        text-align: center;
                        font-weight: bold;
                      "
                    >
                      58.51
                    </td>
                    <td style="padding: 0.75rem; text-align: center">
                      é è¨“ç·´æ¨¡å‹
                    </td>
                  </tr>
                  <tr style="border-bottom: 1px solid #eee">
                    <td style="padding: 0.75rem">llama3-8B-sft (æœ‰å¾®èª¿)</td>
                    <td
                      style="
                        padding: 0.75rem;
                        text-align: center;
                        font-weight: bold;
                        color: #2ecc71;
                      "
                    >
                      82.6
                    </td>
                    <td
                      style="
                        padding: 0.75rem;
                        text-align: center;
                        color: #2ecc71;
                      "
                    >
                      âœ… æœ€ä½³è¡¨ç¾
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p style="margin-top: 1rem; font-size: 1.1rem; color: #e74c3c">
              ğŸ’¡ å¾®èª¿å¾Œçš„ llama3-8B æ¨¡å‹è¡¨ç¾æœ€ä½³ï¼Œåˆ†æ•¸æå‡ç´„ 41%
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="navigation">
      <button class="nav-btn" onclick="prevSlide()">ä¸Šä¸€é </button>
      <button class="nav-btn" onclick="nextSlide()">ä¸‹ä¸€é </button>
    </div>

    <!-- æ·»åŠ  Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-bash.min.js"></script>
    <script>
      let currentSlide = 0;
      const slides = document.querySelectorAll(".slide");

      // ä»localStorageè·å–ä¸Šæ¬¡æŸ¥çœ‹çš„å¹»ç¯ç‰‡ä½ç½®
      function getLastViewedSlide() {
        const lastSlide = localStorage.getItem("lastViewedSlide");
        return lastSlide ? parseInt(lastSlide) : 0;
      }

      // ä¿å­˜å½“å‰å¹»ç¯ç‰‡ä½ç½®åˆ°localStorage
      function saveCurrentSlide() {
        localStorage.setItem("lastViewedSlide", currentSlide);
      }

      function showSlide(n) {
        slides.forEach((slide) => slide.classList.remove("active"));
        currentSlide = (n + slides.length) % slides.length;
        slides[currentSlide].classList.add("active");
        // ä¿å­˜å½“å‰å¹»ç¯ç‰‡ä½ç½®
        saveCurrentSlide();
        // é‡æ–°åº”ç”¨è¯­æ³•é«˜äº®
        Prism.highlightAll();
      }

      function nextSlide() {
        showSlide(currentSlide + 1);
      }

      function prevSlide() {
        showSlide(currentSlide - 1);
      }

      // Keyboard navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") nextSlide();
        if (e.key === "ArrowLeft") prevSlide();
      });

      // åˆå§‹åŒ–è¯­æ³•é«˜äº®
      document.addEventListener("DOMContentLoaded", (event) => {
        // ä»localStorageè·å–ä¸Šæ¬¡æŸ¥çœ‹çš„å¹»ç¯ç‰‡ä½ç½®å¹¶æ˜¾ç¤º
        const lastSlide = getLastViewedSlide();
        showSlide(lastSlide);
        Prism.highlightAll();
      });
    </script>
  </body>
</html>
